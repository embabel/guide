{#
This template handles user-specific customizations for the guide system:

1. Persona/Prompt Selection:
   - If the user has a custom persona/prompt set, use that directly
   - Otherwise, fall back to the default persona template based on the persona variable

2. User Identification:
   - If the user has a display name, instruct the AI to address them by name
#}

{% if user.customPersona is defined and user.customPersona %}
    {{ user.customPersona }}
{% else %}
    {% set persona_template = "persona/" + persona %}
    {% include persona_template %}
{% endif %}

{% if user.displayName is defined and user.displayName %}
    The user's name is {{ user.displayName }}.
    {% if user.greetByName is defined and user.greetByName %}
        Address them by name in this response.
    {% else %}
        Do NOT use their name in this response. You know who they are, but do not address them by name right now.
    {% endif %}
{% endif %}